<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>Class: Jabber::Client</title>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
  <meta http-equiv="Content-Script-Type" content="text/javascript" />
  <link rel="stylesheet" href="../.././rdoc-style.css" type="text/css" media="screen" />
  <script type="text/javascript">
  // <![CDATA[

  function popupCode( url ) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }

  function toggleCode( id ) {
    if ( document.getElementById )
      elem = document.getElementById( id );
    else if ( document.all )
      elem = eval( "document.all." + id );
    else
      return false;

    elemStyle = elem.style;
    
    if ( elemStyle.display != "block" ) {
      elemStyle.display = "block"
    } else {
      elemStyle.display = "none"
    }

    return true;
  }
  
  // Make codeblocks hidden by default
  document.writeln( "<style type=\"text/css\">div.method-source-code { display: none }</style>" )
  
  // ]]>
  </script>

</head>
<body>



    <div id="classHeader">
        <table class="header-table">
        <tr class="top-aligned-row">
          <td><strong>Class</strong></td>
          <td class="class-name-in-header">Jabber::Client</td>
        </tr>
        <tr class="top-aligned-row">
            <td><strong>In:</strong></td>
            <td>
                <a href="../../files/lib/xmpp4r/client_rb.html">
                lib/xmpp4r/client.rb
                </a>
        <br />
            </td>
        </tr>

        <tr class="top-aligned-row">
            <td><strong>Parent:</strong></td>
            <td>
                <a href="Connection.html">
                Connection
               </a>
            </td>
        </tr>
        </table>
    </div>
  <!-- banner header -->

  <div id="bodyContent">



  <div id="contextContent">

    <div id="description">
      <p>
The client class provides everything needed to build a basic XMPP <a
href="Client.html">Client</a>.
</p>
<p>
If you want your connection to survive disconnects and timeouts, catch
exception in <a href="Stream.html#M000633">Stream#on_exception</a> and
re-call <a href="Client.html#M000615">Client#connect</a> and <a
href="Client.html#M000618">Client#auth</a>. Don&#8216;t forget to re-send
initial <a href="Presence.html">Presence</a> and everything else you need
to setup your session.
</p>

    </div>


   </div>

    <div id="method-list">
      <h3 class="section-bar">Methods</h3>

      <div class="name-list">
      <a href="#M000618">auth</a>&nbsp;&nbsp;
      <a href="#M000622">auth_anonymous</a>&nbsp;&nbsp;
      <a href="#M000623">auth_anonymous_sasl</a>&nbsp;&nbsp;
      <a href="#M000625">auth_nonsasl</a>&nbsp;&nbsp;
      <a href="#M000621">auth_sasl</a>&nbsp;&nbsp;
      <a href="#M000619">bind</a>&nbsp;&nbsp;
      <a href="#M000616">close</a>&nbsp;&nbsp;
      <a href="#M000615">connect</a>&nbsp;&nbsp;
      <a href="#M000614">new</a>&nbsp;&nbsp;
      <a href="#M000629">password=</a>&nbsp;&nbsp;
      <a href="#M000627">register</a>&nbsp;&nbsp;
      <a href="#M000626">register_info</a>&nbsp;&nbsp;
      <a href="#M000628">remove_registration</a>&nbsp;&nbsp;
      <a href="#M000617">start</a>&nbsp;&nbsp;
      <a href="#M000624">supports_anonymous?</a>&nbsp;&nbsp;
      <a href="#M000620">unbind</a>&nbsp;&nbsp;
      </div>
    </div>

  </div>


    <!-- if includes -->

    <div id="section">





    <div id="attribute-list">
      <h3 class="section-bar">Attributes</h3>

      <div class="name-list">
        <table>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">jid</td>
          <td class="context-item-value">&nbsp;[R]&nbsp;</td>
          <td class="context-item-desc">
The client&#8216;s <a href="JID.html">JID</a>

</td>
        </tr>
        </table>
      </div>
    </div>
      


    <!-- if method_list -->
    <div id="methods">
      <h3 class="section-bar">Public Class methods</h3>

      <div id="method-M000614" class="method-detail">
        <a name="M000614"></a>

        <div class="method-heading">
          <a href="#M000614" class="method-signature">
          <span class="method-name">new</span><span class="method-args">(jid)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Create a <a href="Client.html#M000614">new</a> <a
href="Client.html">Client</a>.
</p>
<p>
Remember to <b>always</b> put a resource in your <a href="JID.html">JID</a>
unless the server can do <a href="SASL.html">SASL</a>.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000614-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000614-source">
<pre>
    <span class="ruby-comment cmt"># File lib/xmpp4r/client.rb, line 27</span>
27:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">initialize</span>(<span class="ruby-identifier">jid</span>)
28:       <span class="ruby-keyword kw">super</span>()
29:       <span class="ruby-ivar">@jid</span> = (<span class="ruby-identifier">jid</span>.<span class="ruby-identifier">kind_of?</span>(<span class="ruby-constant">JID</span>) <span class="ruby-operator">?</span> <span class="ruby-identifier">jid</span> <span class="ruby-operator">:</span> <span class="ruby-constant">JID</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">jid</span>.<span class="ruby-identifier">to_s</span>))
30:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <h3 class="section-bar">Public Instance methods</h3>

      <div id="method-M000618" class="method-detail">
        <a name="M000618"></a>

        <div class="method-heading">
          <a href="#M000618" class="method-signature">
          <span class="method-name">auth</span><span class="method-args">(password)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Authenticate with the server
</p>
<p>
Throws <a
href="ClientAuthenticationFailure.html">ClientAuthenticationFailure</a>
</p>
<p>
Authentication mechanisms are used in the following preference:
</p>
<ul>
<li><a href="SASL.html">SASL</a> DIGEST-MD5

</li>
<li><a href="SASL.html">SASL</a> PLAIN

</li>
<li>Non-<a href="SASL.html">SASL</a> digest

</li>
</ul>
<table>
<tr><td valign="top">password:</td><td>[String]

</td></tr>
</table>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000618-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000618-source">
<pre>
     <span class="ruby-comment cmt"># File lib/xmpp4r/client.rb, line 107</span>
107:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">auth</span>(<span class="ruby-identifier">password</span>)
108:       <span class="ruby-keyword kw">begin</span>
109:         <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@stream_mechanisms</span>.<span class="ruby-identifier">include?</span> <span class="ruby-value str">'DIGEST-MD5'</span>
110:           <span class="ruby-identifier">auth_sasl</span> <span class="ruby-constant">SASL</span>.<span class="ruby-identifier">new</span>(<span class="ruby-keyword kw">self</span>, <span class="ruby-value str">'DIGEST-MD5'</span>), <span class="ruby-identifier">password</span>
111:         <span class="ruby-keyword kw">elsif</span> <span class="ruby-ivar">@stream_mechanisms</span>.<span class="ruby-identifier">include?</span> <span class="ruby-value str">'PLAIN'</span>
112:           <span class="ruby-identifier">auth_sasl</span> <span class="ruby-constant">SASL</span>.<span class="ruby-identifier">new</span>(<span class="ruby-keyword kw">self</span>, <span class="ruby-value str">'PLAIN'</span>), <span class="ruby-identifier">password</span>
113:         <span class="ruby-keyword kw">else</span>
114:           <span class="ruby-identifier">auth_nonsasl</span>(<span class="ruby-identifier">password</span>)
115:         <span class="ruby-keyword kw">end</span>
116:       <span class="ruby-keyword kw">rescue</span>
117:         <span class="ruby-constant">Jabber</span><span class="ruby-operator">::</span><span class="ruby-identifier">debuglog</span>(<span class="ruby-node">&quot;#{$!.class}: #{$!}\n#{$!.backtrace.join(&quot;\n&quot;)}&quot;</span>)
118:         <span class="ruby-identifier">raise</span> <span class="ruby-constant">ClientAuthenticationFailure</span>.<span class="ruby-identifier">new</span>, <span class="ruby-identifier">$!</span>.<span class="ruby-identifier">to_s</span>
119:       <span class="ruby-keyword kw">end</span>
120:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000622" class="method-detail">
        <a name="M000622"></a>

        <div class="method-heading">
          <a href="#M000622" class="method-signature">
          <span class="method-name">auth_anonymous</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
See <a href="Client.html#M000623">Client#auth_anonymous_sasl</a>
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000622-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000622-source">
<pre>
     <span class="ruby-comment cmt"># File lib/xmpp4r/client.rb, line 196</span>
196:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">auth_anonymous</span>
197:       <span class="ruby-identifier">auth_anonymous_sasl</span>
198:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000623" class="method-detail">
        <a name="M000623"></a>

        <div class="method-heading">
          <a href="#M000623" class="method-signature">
          <span class="method-name">auth_anonymous_sasl</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Shortcut for anonymous connection to server
</p>
<p>
Throws <a
href="ClientAuthenticationFailure.html">ClientAuthenticationFailure</a>
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000623-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000623-source">
<pre>
     <span class="ruby-comment cmt"># File lib/xmpp4r/client.rb, line 205</span>
205:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">auth_anonymous_sasl</span>
206:       <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">supports_anonymous?</span>
207:         <span class="ruby-keyword kw">begin</span>
208:           <span class="ruby-identifier">auth_sasl</span> <span class="ruby-constant">SASL</span>.<span class="ruby-identifier">new</span>(<span class="ruby-keyword kw">self</span>, <span class="ruby-value str">'ANONYMOUS'</span>), <span class="ruby-value str">&quot;&quot;</span>
209:         <span class="ruby-keyword kw">rescue</span>
210:           <span class="ruby-constant">Jabber</span><span class="ruby-operator">::</span><span class="ruby-identifier">debuglog</span>(<span class="ruby-node">&quot;#{$!.class}: #{$!}\n#{$!.backtrace.join(&quot;\n&quot;)}&quot;</span>)
211:           <span class="ruby-identifier">raise</span> <span class="ruby-constant">ClientAuthenticationFailure</span>, <span class="ruby-identifier">$!</span>.<span class="ruby-identifier">to_s</span>
212:         <span class="ruby-keyword kw">end</span>
213:       <span class="ruby-keyword kw">else</span>
214:         <span class="ruby-identifier">raise</span> <span class="ruby-constant">ClientAuthenticationFailure</span>, <span class="ruby-value str">'Anonymous authentication unsupported'</span>
215:       <span class="ruby-keyword kw">end</span>
216:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000625" class="method-detail">
        <a name="M000625"></a>

        <div class="method-heading">
          <a href="#M000625" class="method-signature">
          <span class="method-name">auth_nonsasl</span><span class="method-args">(password, digest=true)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Send <a href="Client.html#M000618">auth</a> with given password and wait
for result (non-<a href="SASL.html">SASL</a>)
</p>
<p>
Throws ServerError
</p>
<table>
<tr><td valign="top">password:</td><td>[String] the password

</td></tr>
<tr><td valign="top">digest:</td><td>[Boolean] use Digest authentication

</td></tr>
</table>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000625-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000625-source">
<pre>
     <span class="ruby-comment cmt"># File lib/xmpp4r/client.rb, line 234</span>
234:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">auth_nonsasl</span>(<span class="ruby-identifier">password</span>, <span class="ruby-identifier">digest</span>=<span class="ruby-keyword kw">true</span>)
235:       <span class="ruby-identifier">authset</span> = <span class="ruby-keyword kw">nil</span>
236:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">digest</span>
237:         <span class="ruby-identifier">authset</span> = <span class="ruby-constant">Iq</span>.<span class="ruby-identifier">new_authset_digest</span>(<span class="ruby-ivar">@jid</span>, <span class="ruby-ivar">@streamid</span>.<span class="ruby-identifier">to_s</span>, <span class="ruby-identifier">password</span>)
238:       <span class="ruby-keyword kw">else</span>
239:         <span class="ruby-identifier">authset</span> = <span class="ruby-constant">Iq</span>.<span class="ruby-identifier">new_authset</span>(<span class="ruby-ivar">@jid</span>, <span class="ruby-identifier">password</span>)
240:       <span class="ruby-keyword kw">end</span>
241:       <span class="ruby-identifier">send_with_id</span>(<span class="ruby-identifier">authset</span>)
242:       <span class="ruby-identifier">$defout</span>.<span class="ruby-identifier">flush</span>
243: 
244:       <span class="ruby-keyword kw">true</span>
245:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000621" class="method-detail">
        <a name="M000621"></a>

        <div class="method-heading">
          <a href="#M000621" class="method-signature">
          <span class="method-name">auth_sasl</span><span class="method-args">(sasl, password)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Use a <a href="SASL.html">SASL</a> authentication mechanism and <a
href="Client.html#M000619">bind</a> to a resource
</p>
<p>
If there was no resource given in the jid, the jid/resource generated by
the server will be accepted.
</p>
<p>
This method should not be used directly. Instead, <a
href="Client.html#M000618">Client#auth</a> may look for the best mechanism
suitable.
</p>
<table>
<tr><td valign="top">sasl:</td><td>Descendant of [<a href="SASL/Base.html">Jabber::SASL::Base</a>]

</td></tr>
<tr><td valign="top">password:</td><td>[String]

</td></tr>
</table>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000621-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000621-source">
<pre>
     <span class="ruby-comment cmt"># File lib/xmpp4r/client.rb, line 170</span>
170:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">auth_sasl</span>(<span class="ruby-identifier">sasl</span>, <span class="ruby-identifier">password</span>)
171:       <span class="ruby-identifier">sasl</span>.<span class="ruby-identifier">auth</span>(<span class="ruby-identifier">password</span>)
172: 
173:       <span class="ruby-comment cmt"># Restart stream after SASL auth</span>
174:       <span class="ruby-identifier">stop</span>
175:       <span class="ruby-identifier">start</span>
176:       <span class="ruby-comment cmt"># And wait for features - again</span>
177:       <span class="ruby-ivar">@features_sem</span>.<span class="ruby-identifier">wait</span>
178: 
179:       <span class="ruby-comment cmt"># Resource binding (RFC3920 - 7)</span>
180:       <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@stream_features</span>.<span class="ruby-identifier">has_key?</span> <span class="ruby-value str">'bind'</span>
181:         <span class="ruby-ivar">@jid</span> = <span class="ruby-identifier">bind</span>(<span class="ruby-ivar">@jid</span>.<span class="ruby-identifier">resource</span>)
182:       <span class="ruby-keyword kw">end</span>
183: 
184:       <span class="ruby-comment cmt"># Session starting</span>
185:       <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@stream_features</span>.<span class="ruby-identifier">has_key?</span> <span class="ruby-value str">'session'</span>
186:         <span class="ruby-identifier">iq</span> = <span class="ruby-constant">Iq</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">:set</span>)
187:         <span class="ruby-identifier">session</span> = <span class="ruby-identifier">iq</span>.<span class="ruby-identifier">add</span> <span class="ruby-constant">REXML</span><span class="ruby-operator">::</span><span class="ruby-constant">Element</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value str">'session'</span>)
188:         <span class="ruby-identifier">session</span>.<span class="ruby-identifier">add_namespace</span> <span class="ruby-ivar">@stream_features</span>[<span class="ruby-value str">'session'</span>]
189: 
190:         <span class="ruby-identifier">send_with_id</span>(<span class="ruby-identifier">iq</span>)
191:       <span class="ruby-keyword kw">end</span>
192:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000619" class="method-detail">
        <a name="M000619"></a>

        <div class="method-heading">
          <a href="#M000619" class="method-signature">
          <span class="method-name">bind</span><span class="method-args">(desired_resource=nil)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Resource binding (RFC3920bis-06 - section 8.)
</p>
<p>
XMPP allows to <a href="Client.html#M000619">bind</a> to multiple resources
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000619-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000619-source">
<pre>
     <span class="ruby-comment cmt"># File lib/xmpp4r/client.rb, line 126</span>
126:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">bind</span>(<span class="ruby-identifier">desired_resource</span>=<span class="ruby-keyword kw">nil</span>)
127:       <span class="ruby-identifier">iq</span> = <span class="ruby-constant">Iq</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">:set</span>)
128:       <span class="ruby-identifier">bind</span> = <span class="ruby-identifier">iq</span>.<span class="ruby-identifier">add</span> <span class="ruby-constant">REXML</span><span class="ruby-operator">::</span><span class="ruby-constant">Element</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value str">'bind'</span>)
129:       <span class="ruby-identifier">bind</span>.<span class="ruby-identifier">add_namespace</span> <span class="ruby-ivar">@stream_features</span>[<span class="ruby-value str">'bind'</span>]
130:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">desired_resource</span>
131:         <span class="ruby-identifier">resource</span> = <span class="ruby-identifier">bind</span>.<span class="ruby-identifier">add</span> <span class="ruby-constant">REXML</span><span class="ruby-operator">::</span><span class="ruby-constant">Element</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value str">'resource'</span>)
132:         <span class="ruby-identifier">resource</span>.<span class="ruby-identifier">text</span> = <span class="ruby-identifier">desired_resource</span>
133:       <span class="ruby-keyword kw">end</span>
134: 
135:       <span class="ruby-identifier">jid</span> = <span class="ruby-keyword kw">nil</span>
136:       <span class="ruby-identifier">send_with_id</span>(<span class="ruby-identifier">iq</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">reply</span><span class="ruby-operator">|</span>
137:         <span class="ruby-identifier">reply_bind</span> = <span class="ruby-identifier">reply</span>.<span class="ruby-identifier">first_element</span>(<span class="ruby-value str">'bind'</span>)
138:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">reply_bind</span>
139:           <span class="ruby-identifier">reported_jid</span> = <span class="ruby-identifier">reply_bind</span>.<span class="ruby-identifier">first_element</span>(<span class="ruby-value str">'jid'</span>)
140:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">reported_jid</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">reported_jid</span>.<span class="ruby-identifier">text</span>
141:             <span class="ruby-identifier">jid</span> = <span class="ruby-constant">JID</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">reported_jid</span>.<span class="ruby-identifier">text</span>)
142:           <span class="ruby-keyword kw">end</span>
143:         <span class="ruby-keyword kw">end</span>
144:       <span class="ruby-keyword kw">end</span>
145:       <span class="ruby-identifier">jid</span>
146:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000616" class="method-detail">
        <a name="M000616"></a>

        <div class="method-heading">
          <a href="#M000616" class="method-signature">
          <span class="method-name">close</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Close the connection, sends <tt>&lt;/stream:stream&gt;</tt> tag first
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000616-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000616-source">
<pre>
    <span class="ruby-comment cmt"># File lib/xmpp4r/client.rb, line 77</span>
77:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">close</span>
78:       <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@status</span> <span class="ruby-operator">==</span> <span class="ruby-constant">CONNECTED</span>
79:         <span class="ruby-identifier">send</span>(<span class="ruby-value str">&quot;&lt;/stream:stream&gt;&quot;</span>)
80:       <span class="ruby-keyword kw">end</span>
81:       <span class="ruby-keyword kw">super</span>
82:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000615" class="method-detail">
        <a name="M000615"></a>

        <div class="method-heading">
          <a href="#M000615" class="method-signature">
          <span class="method-name">connect</span><span class="method-args">(host = nil, port = 5222)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
<a href="Client.html#M000615">connect</a> to the server (chaining-friendly)
</p>
<p>
If you omit the optional host argument SRV records for your jid will be
resolved. If none works, fallback is connecting to the domain part of the
jid.
</p>
<table>
<tr><td valign="top">host:</td><td>[String] Optional c2s host, will be extracted from jid if nil

</td></tr>
<tr><td valign="top">use_ssl:</td><td>[Boolean] Optional. Use (old, deprecated) SSL when connecting.

</td></tr>
<tr><td valign="top">return:</td><td>self

</td></tr>
</table>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000615-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000615-source">
<pre>
    <span class="ruby-comment cmt"># File lib/xmpp4r/client.rb, line 42</span>
42:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">connect</span>(<span class="ruby-identifier">host</span> = <span class="ruby-keyword kw">nil</span>, <span class="ruby-identifier">port</span> = <span class="ruby-value">5222</span>)
43:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">host</span>.<span class="ruby-identifier">nil?</span>
44:         <span class="ruby-keyword kw">begin</span>
45:           <span class="ruby-identifier">srv</span> = []
46:           <span class="ruby-constant">Resolv</span><span class="ruby-operator">::</span><span class="ruby-constant">DNS</span>.<span class="ruby-identifier">open</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">dns</span><span class="ruby-operator">|</span>
47:             <span class="ruby-comment cmt"># If ruby version is too old and SRV is unknown, this will raise a NameError</span>
48:             <span class="ruby-comment cmt"># which is caught below</span>
49:             <span class="ruby-constant">Jabber</span><span class="ruby-operator">::</span><span class="ruby-identifier">debuglog</span>(<span class="ruby-node">&quot;RESOLVING:\n_xmpp-client._tcp.#{@jid.domain} (SRV)&quot;</span>)
50:             <span class="ruby-identifier">srv</span> = <span class="ruby-identifier">dns</span>.<span class="ruby-identifier">getresources</span>(<span class="ruby-node">&quot;_xmpp-client._tcp.#{@jid.domain}&quot;</span>, <span class="ruby-constant">Resolv</span><span class="ruby-operator">::</span><span class="ruby-constant">DNS</span><span class="ruby-operator">::</span><span class="ruby-constant">Resource</span><span class="ruby-operator">::</span><span class="ruby-constant">IN</span><span class="ruby-operator">::</span><span class="ruby-constant">SRV</span>)
51:           }
52:           <span class="ruby-comment cmt"># Sort SRV records: lowest priority first, highest weight first</span>
53:           <span class="ruby-identifier">srv</span>.<span class="ruby-identifier">sort!</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">a</span>,<span class="ruby-identifier">b</span><span class="ruby-operator">|</span> (<span class="ruby-identifier">a</span>.<span class="ruby-identifier">priority</span> <span class="ruby-operator">!=</span> <span class="ruby-identifier">b</span>.<span class="ruby-identifier">priority</span>) <span class="ruby-operator">?</span> (<span class="ruby-identifier">a</span>.<span class="ruby-identifier">priority</span> <span class="ruby-operator">&lt;=&gt;</span> <span class="ruby-identifier">b</span>.<span class="ruby-identifier">priority</span>) <span class="ruby-operator">:</span> (<span class="ruby-identifier">b</span>.<span class="ruby-identifier">weight</span> <span class="ruby-operator">&lt;=&gt;</span> <span class="ruby-identifier">a</span>.<span class="ruby-identifier">weight</span>) }
54: 
55:           <span class="ruby-identifier">srv</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">record</span><span class="ruby-operator">|</span>
56:             <span class="ruby-keyword kw">begin</span>
57:               <span class="ruby-identifier">connect</span>(<span class="ruby-identifier">record</span>.<span class="ruby-identifier">target</span>.<span class="ruby-identifier">to_s</span>, <span class="ruby-identifier">record</span>.<span class="ruby-identifier">port</span>)
58:               <span class="ruby-comment cmt"># Success</span>
59:               <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">self</span>
60:             <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">SocketError</span>, <span class="ruby-constant">Errno</span><span class="ruby-operator">::</span><span class="ruby-constant">ECONNREFUSED</span>
61:               <span class="ruby-comment cmt"># Try next SRV record</span>
62:             <span class="ruby-keyword kw">end</span>
63:           }
64:         <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">NameError</span>
65:           <span class="ruby-constant">Jabber</span><span class="ruby-operator">::</span><span class="ruby-identifier">debuglog</span> <span class="ruby-value str">&quot;Resolv::DNS does not support SRV records. Please upgrade to ruby-1.8.3 or later!&quot;</span>
66:         <span class="ruby-keyword kw">end</span>
67:         <span class="ruby-comment cmt"># Fallback to normal connect method</span>
68:       <span class="ruby-keyword kw">end</span>
69: 
70:       <span class="ruby-keyword kw">super</span>(<span class="ruby-identifier">host</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-value">? </span><span class="ruby-identifier">jid</span>.<span class="ruby-identifier">domain</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">host</span>, <span class="ruby-identifier">port</span>)
71:       <span class="ruby-keyword kw">self</span>
72:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000629" class="method-detail">
        <a name="M000629"></a>

        <div class="method-heading">
          <a href="#M000629" class="method-signature">
          <span class="method-name">password=</span><span class="method-args">(new_password)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Change the client&#8216;s password
</p>
<p>
Threading is suggested, as this code waits for an answer.
</p>
<p>
Raises an exception upon error response (ServerError from <a
href="Stream.html#M000646">Stream#send_with_id</a>).
</p>
<table>
<tr><td valign="top">new_password:</td><td>[String] New password

</td></tr>
</table>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000629-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000629-source">
<pre>
     <span class="ruby-comment cmt"># File lib/xmpp4r/client.rb, line 334</span>
334:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">password=</span>(<span class="ruby-identifier">new_password</span>)
335:       <span class="ruby-identifier">iq</span> = <span class="ruby-constant">Iq</span>.<span class="ruby-identifier">new_query</span>(<span class="ruby-identifier">:set</span>, <span class="ruby-ivar">@jid</span>.<span class="ruby-identifier">domain</span>)
336:       <span class="ruby-identifier">iq</span>.<span class="ruby-identifier">query</span>.<span class="ruby-identifier">add_namespace</span>(<span class="ruby-value str">'jabber:iq:register'</span>)
337:       <span class="ruby-identifier">iq</span>.<span class="ruby-identifier">query</span>.<span class="ruby-identifier">add</span>(<span class="ruby-constant">REXML</span><span class="ruby-operator">::</span><span class="ruby-constant">Element</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value str">'username'</span>)).<span class="ruby-identifier">text</span> = <span class="ruby-ivar">@jid</span>.<span class="ruby-identifier">node</span>
338:       <span class="ruby-identifier">iq</span>.<span class="ruby-identifier">query</span>.<span class="ruby-identifier">add</span>(<span class="ruby-constant">REXML</span><span class="ruby-operator">::</span><span class="ruby-constant">Element</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value str">'password'</span>)).<span class="ruby-identifier">text</span> = <span class="ruby-identifier">new_password</span>
339: 
340:       <span class="ruby-identifier">err</span> = <span class="ruby-keyword kw">nil</span>
341:       <span class="ruby-identifier">send_with_id</span>(<span class="ruby-identifier">iq</span>)
342:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000627" class="method-detail">
        <a name="M000627"></a>

        <div class="method-heading">
          <a href="#M000627" class="method-signature">
          <span class="method-name">register</span><span class="method-args">(password, fields={})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Register a <a href="Client.html#M000614">new</a> user account (may be used
instead of <a href="Client.html#M000618">Client#auth</a>)
</p>
<p>
This method may raise ServerError if the registration was not successful.
</p>
<table>
<tr><td valign="top">password:</td><td>String

</td></tr>
<tr><td valign="top">fields:</td><td>{String=&gt;String} additional registration information

</td></tr>
</table>
<p>
XEP-0077 Defines the following fields for registration information: <a
href="http://www.xmpp.org/extensions/xep-0077.html">www.xmpp.org/extensions/xep-0077.html</a>
</p>
<p>
&#8216;username&#8217; =&gt; &#8216;Account name associated with the
user&#8217; &#8216;nick&#8217; =&gt; &#8216;Familiar name of the
user&#8217; &#8216;password&#8217; =&gt; &#8216;Password or secret for the
user&#8217; &#8216;name&#8217; =&gt; &#8216;Full name of the user&#8217;
&#8216;first&#8217; =&gt; &#8216;First name or given name of the
user&#8217; &#8216;last&#8217; =&gt; &#8216;Last name, surname, or family
name of the user&#8217; &#8216;email&#8217; =&gt; &#8216;Email address of
the user&#8217; &#8216;address&#8217; =&gt; &#8216;Street portion of a
physical or mailing address&#8217; &#8216;city&#8217; =&gt; &#8216;Locality
portion of a physical or mailing address&#8217; &#8216;state&#8217; =&gt;
&#8216;Region portion of a physical or mailing address&#8217;
&#8216;zip&#8217; =&gt; &#8216;Postal code portion of a physical or mailing
address&#8217; &#8216;phone&#8217; =&gt; &#8216;Telephone number of the
user&#8217; &#8216;url&#8217; =&gt; &#8216;URL to web page describing the
user&#8217; &#8216;date&#8217; =&gt; &#8216;Some date (e.g., birth date,
hire date, sign-up date)&#8217;
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000627-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000627-source">
<pre>
     <span class="ruby-comment cmt"># File lib/xmpp4r/client.rb, line 303</span>
303:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">register</span>(<span class="ruby-identifier">password</span>, <span class="ruby-identifier">fields</span>={})
304:       <span class="ruby-identifier">reg</span> = <span class="ruby-constant">Iq</span>.<span class="ruby-identifier">new_register</span>(<span class="ruby-identifier">jid</span>.<span class="ruby-identifier">node</span>, <span class="ruby-identifier">password</span>)
305:       <span class="ruby-identifier">reg</span>.<span class="ruby-identifier">to</span> = <span class="ruby-identifier">jid</span>.<span class="ruby-identifier">domain</span>
306:       <span class="ruby-identifier">fields</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">name</span>,<span class="ruby-identifier">value</span><span class="ruby-operator">|</span>
307:         <span class="ruby-identifier">reg</span>.<span class="ruby-identifier">query</span>.<span class="ruby-identifier">add</span>(<span class="ruby-constant">REXML</span><span class="ruby-operator">::</span><span class="ruby-constant">Element</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">name</span>)).<span class="ruby-identifier">text</span> = <span class="ruby-identifier">value</span>
308:       }
309: 
310:       <span class="ruby-identifier">send_with_id</span>(<span class="ruby-identifier">reg</span>)
311:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000626" class="method-detail">
        <a name="M000626"></a>

        <div class="method-heading">
          <a href="#M000626" class="method-signature">
          <span class="method-name">register_info</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Get instructions and available fields for registration
</p>
<table>
<tr><td valign="top">return:</td><td>[instructions, fields] Where instructions is a String and fields is an
Array of Strings

</td></tr>
</table>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000626-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000626-source">
<pre>
     <span class="ruby-comment cmt"># File lib/xmpp4r/client.rb, line 250</span>
250:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">register_info</span>
251:       <span class="ruby-identifier">instructions</span> = <span class="ruby-keyword kw">nil</span>
252:       <span class="ruby-identifier">fields</span> = []
253: 
254:       <span class="ruby-identifier">reg</span> = <span class="ruby-constant">Iq</span>.<span class="ruby-identifier">new_registerget</span>
255:       <span class="ruby-identifier">reg</span>.<span class="ruby-identifier">to</span> = <span class="ruby-identifier">jid</span>.<span class="ruby-identifier">domain</span>
256:       <span class="ruby-identifier">send_with_id</span>(<span class="ruby-identifier">reg</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">answer</span><span class="ruby-operator">|</span>
257:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">answer</span>.<span class="ruby-identifier">query</span>
258:           <span class="ruby-identifier">answer</span>.<span class="ruby-identifier">query</span>.<span class="ruby-identifier">each_element</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">e</span><span class="ruby-operator">|</span>
259:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">e</span>.<span class="ruby-identifier">namespace</span> <span class="ruby-operator">==</span> <span class="ruby-value str">'jabber:iq:register'</span>
260:               <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">e</span>.<span class="ruby-identifier">name</span> <span class="ruby-operator">==</span> <span class="ruby-value str">'instructions'</span>
261:                 <span class="ruby-identifier">instructions</span> = <span class="ruby-identifier">e</span>.<span class="ruby-identifier">text</span>.<span class="ruby-identifier">strip</span>
262:               <span class="ruby-keyword kw">else</span>
263:                 <span class="ruby-identifier">fields</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">e</span>.<span class="ruby-identifier">name</span>
264:               <span class="ruby-keyword kw">end</span>
265:             <span class="ruby-keyword kw">end</span>
266:           }
267:         <span class="ruby-keyword kw">end</span>
268: 
269:         <span class="ruby-keyword kw">true</span>
270:       <span class="ruby-keyword kw">end</span>
271: 
272:       [<span class="ruby-identifier">instructions</span>, <span class="ruby-identifier">fields</span>]
273:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000628" class="method-detail">
        <a name="M000628"></a>

        <div class="method-heading">
          <a href="#M000628" class="method-signature">
          <span class="method-name">remove_registration</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Remove the registration of a user account
</p>
<p>
*WARNING:* this deletes your roster and everything else stored on the
server!
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000628-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000628-source">
<pre>
     <span class="ruby-comment cmt"># File lib/xmpp4r/client.rb, line 318</span>
318:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">remove_registration</span>
319:       <span class="ruby-identifier">reg</span> = <span class="ruby-constant">Iq</span>.<span class="ruby-identifier">new_register</span>
320:       <span class="ruby-identifier">reg</span>.<span class="ruby-identifier">to</span> = <span class="ruby-identifier">jid</span>.<span class="ruby-identifier">domain</span>
321:       <span class="ruby-identifier">reg</span>.<span class="ruby-identifier">query</span>.<span class="ruby-identifier">add</span>(<span class="ruby-constant">REXML</span><span class="ruby-operator">::</span><span class="ruby-constant">Element</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value str">'remove'</span>))
322:       <span class="ruby-identifier">send_with_id</span>(<span class="ruby-identifier">reg</span>)
323:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000617" class="method-detail">
        <a name="M000617"></a>

        <div class="method-heading">
          <a href="#M000617" class="method-signature">
          <span class="method-name">start</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Start the stream-parser and send the client-specific stream opening element
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000617-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000617-source">
<pre>
    <span class="ruby-comment cmt"># File lib/xmpp4r/client.rb, line 86</span>
86:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">start</span>
87:       <span class="ruby-keyword kw">super</span>
88:       <span class="ruby-identifier">send</span>(<span class="ruby-identifier">generate_stream_start</span>(<span class="ruby-ivar">@jid</span>.<span class="ruby-identifier">domain</span>)) { <span class="ruby-operator">|</span><span class="ruby-identifier">e</span><span class="ruby-operator">|</span>
89:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">e</span>.<span class="ruby-identifier">name</span> <span class="ruby-operator">==</span> <span class="ruby-value str">'stream'</span>
90:           <span class="ruby-keyword kw">true</span>
91:         <span class="ruby-keyword kw">else</span>
92:           <span class="ruby-keyword kw">false</span>
93:         <span class="ruby-keyword kw">end</span>
94:       }
95:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000624" class="method-detail">
        <a name="M000624"></a>

        <div class="method-heading">
          <a href="#M000624" class="method-signature">
          <span class="method-name">supports_anonymous?</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Reports whether or not anonymous authentication is reported by the client.
</p>
<p>
Returns true or false
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000624-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000624-source">
<pre>
     <span class="ruby-comment cmt"># File lib/xmpp4r/client.rb, line 223</span>
223:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">supports_anonymous?</span>
224:       <span class="ruby-ivar">@stream_mechanisms</span>.<span class="ruby-identifier">include?</span> <span class="ruby-value str">'ANONYMOUS'</span>
225:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000620" class="method-detail">
        <a name="M000620"></a>

        <div class="method-heading">
          <a href="#M000620" class="method-signature">
          <span class="method-name">unbind</span><span class="method-args">(desired_resource)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Resource unbinding (RFC3920bis-06 - section 8.6.3.)
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000620-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000620-source">
<pre>
     <span class="ruby-comment cmt"># File lib/xmpp4r/client.rb, line 150</span>
150:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">unbind</span>(<span class="ruby-identifier">desired_resource</span>)
151:       <span class="ruby-identifier">iq</span> = <span class="ruby-constant">Iq</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">:set</span>)
152:       <span class="ruby-identifier">unbind</span> = <span class="ruby-identifier">iq</span>.<span class="ruby-identifier">add</span> <span class="ruby-constant">REXML</span><span class="ruby-operator">::</span><span class="ruby-constant">Element</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value str">'unbind'</span>)
153:       <span class="ruby-identifier">unbind</span>.<span class="ruby-identifier">add_namespace</span> <span class="ruby-ivar">@stream_features</span>[<span class="ruby-value str">'unbind'</span>]
154:       <span class="ruby-identifier">resource</span> = <span class="ruby-identifier">unbind</span>.<span class="ruby-identifier">add</span> <span class="ruby-constant">REXML</span><span class="ruby-operator">::</span><span class="ruby-constant">Element</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value str">'resource'</span>)
155:       <span class="ruby-identifier">resource</span>.<span class="ruby-identifier">text</span> = <span class="ruby-identifier">desired_resource</span>
156: 
157:       <span class="ruby-identifier">send_with_id</span>(<span class="ruby-identifier">iq</span>)
158:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>


    </div>


  </div>


<div id="validator-badges">
  <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
</div>

</body>
</html>