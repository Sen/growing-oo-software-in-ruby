<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>Class: Jabber::Stream</title>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
  <meta http-equiv="Content-Script-Type" content="text/javascript" />
  <link rel="stylesheet" href="../.././rdoc-style.css" type="text/css" media="screen" />
  <script type="text/javascript">
  // <![CDATA[

  function popupCode( url ) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }

  function toggleCode( id ) {
    if ( document.getElementById )
      elem = document.getElementById( id );
    else if ( document.all )
      elem = eval( "document.all." + id );
    else
      return false;

    elemStyle = elem.style;
    
    if ( elemStyle.display != "block" ) {
      elemStyle.display = "block"
    } else {
      elemStyle.display = "none"
    }

    return true;
  }
  
  // Make codeblocks hidden by default
  document.writeln( "<style type=\"text/css\">div.method-source-code { display: none }</style>" )
  
  // ]]>
  </script>

</head>
<body>



    <div id="classHeader">
        <table class="header-table">
        <tr class="top-aligned-row">
          <td><strong>Class</strong></td>
          <td class="class-name-in-header">Jabber::Stream</td>
        </tr>
        <tr class="top-aligned-row">
            <td><strong>In:</strong></td>
            <td>
                <a href="../../files/lib/xmpp4r/stream_rb.html">
                lib/xmpp4r/stream.rb
                </a>
        <br />
            </td>
        </tr>

        <tr class="top-aligned-row">
            <td><strong>Parent:</strong></td>
            <td>
                Object
            </td>
        </tr>
        </table>
    </div>
  <!-- banner header -->

  <div id="bodyContent">



  <div id="contextContent">

    <div id="description">
      <p>
The stream class manages a connection stream (a file descriptor using which
XML messages are read and sent)
</p>
<p>
You may register callbacks for the three <a
href="../Jabber.html">Jabber</a> stanzas (message, presence and iq) and use
the <a href="Stream.html#M000645">send</a> and <a
href="Stream.html#M000646">send_with_id</a> methods.
</p>
<p>
To ensure the order of received stanzas, callback blocks are launched in
the parser thread. If further blocking operations are intended in those
callbacks, run your own thread there.
</p>

    </div>


   </div>

    <div id="method-list">
      <h3 class="section-bar">Methods</h3>

      <div class="name-list">
      <a href="#M000655">add_iq_callback</a>&nbsp;&nbsp;
      <a href="#M000649">add_message_callback</a>&nbsp;&nbsp;
      <a href="#M000653">add_presence_callback</a>&nbsp;&nbsp;
      <a href="#M000651">add_stanza_callback</a>&nbsp;&nbsp;
      <a href="#M000647">add_xml_callback</a>&nbsp;&nbsp;
      <a href="#M000657">close</a>&nbsp;&nbsp;
      <a href="#M000658">close!</a>&nbsp;&nbsp;
      <a href="#M000656">delete_iq_callback</a>&nbsp;&nbsp;
      <a href="#M000650">delete_message_callback</a>&nbsp;&nbsp;
      <a href="#M000654">delete_presence_callback</a>&nbsp;&nbsp;
      <a href="#M000652">delete_stanza_callback</a>&nbsp;&nbsp;
      <a href="#M000648">delete_xml_callback</a>&nbsp;&nbsp;
      <a href="#M000639">iq_callbacks</a>&nbsp;&nbsp;
      <a href="#M000636">is_connected?</a>&nbsp;&nbsp;
      <a href="#M000637">is_disconnected?</a>&nbsp;&nbsp;
      <a href="#M000640">message_callbacks</a>&nbsp;&nbsp;
      <a href="#M000630">new</a>&nbsp;&nbsp;
      <a href="#M000633">on_exception</a>&nbsp;&nbsp;
      <a href="#M000634">parse_failure</a>&nbsp;&nbsp;
      <a href="#M000635">parser_end</a>&nbsp;&nbsp;
      <a href="#M000641">presence_callbacks</a>&nbsp;&nbsp;
      <a href="#M000638">receive</a>&nbsp;&nbsp;
      <a href="#M000645">send</a>&nbsp;&nbsp;
      <a href="#M000644">send_data</a>&nbsp;&nbsp;
      <a href="#M000646">send_with_id</a>&nbsp;&nbsp;
      <a href="#M000642">stanza_callbacks</a>&nbsp;&nbsp;
      <a href="#M000631">start</a>&nbsp;&nbsp;
      <a href="#M000632">stop</a>&nbsp;&nbsp;
      <a href="#M000643">xml_callbacks</a>&nbsp;&nbsp;
      </div>
    </div>

  </div>


    <!-- if includes -->

    <div id="section">

    <div id="class-list">
      <h3 class="section-bar">Classes and Modules</h3>

      Class <a href="Stream/ThreadBlock.html" class="link">Jabber::Stream::ThreadBlock</a><br />

    </div>

    <div id="constants-list">
      <h3 class="section-bar">Constants</h3>

      <div class="name-list">
        <table summary="Constants">
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">DISCONNECTED</td>
          <td>=</td>
          <td class="context-item-value">1</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">CONNECTED</td>
          <td>=</td>
          <td class="context-item-value">2</td>
        </tr>
        </table>
      </div>
    </div>



    <div id="attribute-list">
      <h3 class="section-bar">Attributes</h3>

      <div class="name-list">
        <table>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">fd</td>
          <td class="context-item-value">&nbsp;[R]&nbsp;</td>
          <td class="context-item-desc">
file descriptor used

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">processing</td>
          <td class="context-item-value">&nbsp;[R]&nbsp;</td>
          <td class="context-item-desc">
number of stanzas currently being processed

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">status</td>
          <td class="context-item-value">&nbsp;[R]&nbsp;</td>
          <td class="context-item-desc">
connection status

</td>
        </tr>
        </table>
      </div>
    </div>
      


    <!-- if method_list -->
    <div id="methods">
      <h3 class="section-bar">Public Class methods</h3>

      <div id="method-M000630" class="method-detail">
        <a name="M000630"></a>

        <div class="method-heading">
          <a href="#M000630" class="method-signature">
          <span class="method-name">new</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Initialize a <a href="Stream.html#M000630">new</a> stream
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000630-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000630-source">
<pre>
    <span class="ruby-comment cmt"># File lib/xmpp4r/stream.rb, line 43</span>
43:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">initialize</span>
44:       <span class="ruby-ivar">@fd</span> = <span class="ruby-keyword kw">nil</span>
45:       <span class="ruby-ivar">@status</span> = <span class="ruby-constant">DISCONNECTED</span>
46:       <span class="ruby-ivar">@xmlcbs</span> = <span class="ruby-constant">CallbackList</span>.<span class="ruby-identifier">new</span>
47:       <span class="ruby-ivar">@stanzacbs</span> = <span class="ruby-constant">CallbackList</span>.<span class="ruby-identifier">new</span>
48:       <span class="ruby-ivar">@messagecbs</span> = <span class="ruby-constant">CallbackList</span>.<span class="ruby-identifier">new</span>
49:       <span class="ruby-ivar">@iqcbs</span> = <span class="ruby-constant">CallbackList</span>.<span class="ruby-identifier">new</span>
50:       <span class="ruby-ivar">@presencecbs</span> = <span class="ruby-constant">CallbackList</span>.<span class="ruby-identifier">new</span>
51:       <span class="ruby-ivar">@send_lock</span> = <span class="ruby-constant">Mutex</span>.<span class="ruby-identifier">new</span>
52:       <span class="ruby-ivar">@last_send</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
53:       <span class="ruby-ivar">@exception_block</span> = <span class="ruby-keyword kw">nil</span>
54:       <span class="ruby-ivar">@tbcbmutex</span> = <span class="ruby-constant">Mutex</span>.<span class="ruby-identifier">new</span>
55:       <span class="ruby-ivar">@threadblocks</span> = []
56:       <span class="ruby-ivar">@wakeup_thread</span> = <span class="ruby-keyword kw">nil</span>
57:       <span class="ruby-ivar">@streamid</span> = <span class="ruby-keyword kw">nil</span>
58:       <span class="ruby-ivar">@streamns</span> = <span class="ruby-value str">'jabber:client'</span>
59:       <span class="ruby-ivar">@features_sem</span> = <span class="ruby-constant">Semaphore</span>.<span class="ruby-identifier">new</span>
60:       <span class="ruby-ivar">@parser_thread</span> = <span class="ruby-keyword kw">nil</span>
61:       <span class="ruby-ivar">@processing</span> = <span class="ruby-value">0</span>
62:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <h3 class="section-bar">Public Instance methods</h3>

      <div id="method-M000655" class="method-detail">
        <a name="M000655"></a>

        <div class="method-heading">
          <a href="#M000655" class="method-signature">
          <span class="method-name">add_iq_callback</span><span class="method-args">(priority = 0, ref = nil, &amp;block)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Adds a callback block to process received Iqs
</p>
<table>
<tr><td valign="top">priority:</td><td>[Integer] The callback&#8216;s priority, the higher, the sooner

</td></tr>
<tr><td valign="top">ref:</td><td>[String] The callback&#8216;s reference

</td></tr>
<tr><td valign="top">&amp;block:</td><td>[Block] The optional block

</td></tr>
</table>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000655-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000655-source">
<pre>
     <span class="ruby-comment cmt"># File lib/xmpp4r/stream.rb, line 552</span>
552:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">add_iq_callback</span>(<span class="ruby-identifier">priority</span> = <span class="ruby-value">0</span>, <span class="ruby-identifier">ref</span> = <span class="ruby-keyword kw">nil</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
553:       <span class="ruby-ivar">@tbcbmutex</span>.<span class="ruby-identifier">synchronize</span> <span class="ruby-keyword kw">do</span>
554:         <span class="ruby-ivar">@iqcbs</span>.<span class="ruby-identifier">add</span>(<span class="ruby-identifier">priority</span>, <span class="ruby-identifier">ref</span>, <span class="ruby-identifier">block</span>)
555:       <span class="ruby-keyword kw">end</span>
556:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000649" class="method-detail">
        <a name="M000649"></a>

        <div class="method-heading">
          <a href="#M000649" class="method-signature">
          <span class="method-name">add_message_callback</span><span class="method-args">(priority = 0, ref = nil, &amp;block)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Adds a callback block to process received Messages
</p>
<table>
<tr><td valign="top">priority:</td><td>[Integer] The callback&#8216;s priority, the higher, the sooner

</td></tr>
<tr><td valign="top">ref:</td><td>[String] The callback&#8216;s reference

</td></tr>
<tr><td valign="top">&amp;block:</td><td>[Block] The optional block

</td></tr>
</table>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000649-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000649-source">
<pre>
     <span class="ruby-comment cmt"># File lib/xmpp4r/stream.rb, line 486</span>
486:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">add_message_callback</span>(<span class="ruby-identifier">priority</span> = <span class="ruby-value">0</span>, <span class="ruby-identifier">ref</span> = <span class="ruby-keyword kw">nil</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
487:       <span class="ruby-ivar">@tbcbmutex</span>.<span class="ruby-identifier">synchronize</span> <span class="ruby-keyword kw">do</span>
488:         <span class="ruby-ivar">@messagecbs</span>.<span class="ruby-identifier">add</span>(<span class="ruby-identifier">priority</span>, <span class="ruby-identifier">ref</span>, <span class="ruby-identifier">block</span>)
489:       <span class="ruby-keyword kw">end</span>
490:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000653" class="method-detail">
        <a name="M000653"></a>

        <div class="method-heading">
          <a href="#M000653" class="method-signature">
          <span class="method-name">add_presence_callback</span><span class="method-args">(priority = 0, ref = nil, &amp;block)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Adds a callback block to process received Presences
</p>
<table>
<tr><td valign="top">priority:</td><td>[Integer] The callback&#8216;s priority, the higher, the sooner

</td></tr>
<tr><td valign="top">ref:</td><td>[String] The callback&#8216;s reference

</td></tr>
<tr><td valign="top">&amp;block:</td><td>[Block] The optional block

</td></tr>
</table>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000653-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000653-source">
<pre>
     <span class="ruby-comment cmt"># File lib/xmpp4r/stream.rb, line 530</span>
530:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">add_presence_callback</span>(<span class="ruby-identifier">priority</span> = <span class="ruby-value">0</span>, <span class="ruby-identifier">ref</span> = <span class="ruby-keyword kw">nil</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
531:       <span class="ruby-ivar">@tbcbmutex</span>.<span class="ruby-identifier">synchronize</span> <span class="ruby-keyword kw">do</span>
532:         <span class="ruby-ivar">@presencecbs</span>.<span class="ruby-identifier">add</span>(<span class="ruby-identifier">priority</span>, <span class="ruby-identifier">ref</span>, <span class="ruby-identifier">block</span>)
533:       <span class="ruby-keyword kw">end</span>
534:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000651" class="method-detail">
        <a name="M000651"></a>

        <div class="method-heading">
          <a href="#M000651" class="method-signature">
          <span class="method-name">add_stanza_callback</span><span class="method-args">(priority = 0, ref = nil, &amp;block)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Adds a callback block to process received Stanzas
</p>
<table>
<tr><td valign="top">priority:</td><td>[Integer] The callback&#8216;s priority, the higher, the sooner

</td></tr>
<tr><td valign="top">ref:</td><td>[String] The callback&#8216;s reference

</td></tr>
<tr><td valign="top">&amp;block:</td><td>[Block] The optional block

</td></tr>
</table>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000651-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000651-source">
<pre>
     <span class="ruby-comment cmt"># File lib/xmpp4r/stream.rb, line 508</span>
508:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">add_stanza_callback</span>(<span class="ruby-identifier">priority</span> = <span class="ruby-value">0</span>, <span class="ruby-identifier">ref</span> = <span class="ruby-keyword kw">nil</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
509:       <span class="ruby-ivar">@tbcbmutex</span>.<span class="ruby-identifier">synchronize</span> <span class="ruby-keyword kw">do</span>
510:         <span class="ruby-ivar">@stanzacbs</span>.<span class="ruby-identifier">add</span>(<span class="ruby-identifier">priority</span>, <span class="ruby-identifier">ref</span>, <span class="ruby-identifier">block</span>)
511:       <span class="ruby-keyword kw">end</span>
512:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000647" class="method-detail">
        <a name="M000647"></a>

        <div class="method-heading">
          <a href="#M000647" class="method-signature">
          <span class="method-name">add_xml_callback</span><span class="method-args">(priority = 0, ref = nil, &amp;block)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Adds a callback block to process received XML messages, these will be
handled before any blocks given to <a
href="Stream.html#M000645">Stream#send</a> or other callbacks.
</p>
<table>
<tr><td valign="top">priority:</td><td>[Integer] The callback&#8216;s priority, the higher, the sooner

</td></tr>
<tr><td valign="top">ref:</td><td>[String] The callback&#8216;s reference

</td></tr>
<tr><td valign="top">&amp;block:</td><td>[Block] The optional block

</td></tr>
</table>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000647-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000647-source">
<pre>
     <span class="ruby-comment cmt"># File lib/xmpp4r/stream.rb, line 464</span>
464:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">add_xml_callback</span>(<span class="ruby-identifier">priority</span> = <span class="ruby-value">0</span>, <span class="ruby-identifier">ref</span> = <span class="ruby-keyword kw">nil</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
465:       <span class="ruby-ivar">@tbcbmutex</span>.<span class="ruby-identifier">synchronize</span> <span class="ruby-keyword kw">do</span>
466:         <span class="ruby-ivar">@xmlcbs</span>.<span class="ruby-identifier">add</span>(<span class="ruby-identifier">priority</span>, <span class="ruby-identifier">ref</span>, <span class="ruby-identifier">block</span>)
467:       <span class="ruby-keyword kw">end</span>
468:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000657" class="method-detail">
        <a name="M000657"></a>

        <div class="method-heading">
          <a href="#M000657" class="method-signature">
          <span class="method-name">close</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Closes the connection to the <a href="../Jabber.html">Jabber</a> service
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000657-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000657-source">
<pre>
     <span class="ruby-comment cmt"># File lib/xmpp4r/stream.rb, line 570</span>
570:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">close</span>
571:       <span class="ruby-identifier">close!</span>
572:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000658" class="method-detail">
        <a name="M000658"></a>

        <div class="method-heading">
          <a href="#M000658" class="method-signature">
          <span class="method-name">close!</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000658-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000658-source">
<pre>
     <span class="ruby-comment cmt"># File lib/xmpp4r/stream.rb, line 574</span>
574:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">close!</span>
575:       <span class="ruby-identifier">pr</span> = <span class="ruby-value">1</span>
576:       <span class="ruby-identifier">n</span> = <span class="ruby-value">0</span>
577:       <span class="ruby-comment cmt"># In some cases, we might lost count of some stanzas</span>
578:       <span class="ruby-comment cmt"># (for example, if the handler raises an exception)</span>
579:       <span class="ruby-comment cmt"># so we can't block forever.</span>
580:       <span class="ruby-keyword kw">while</span> <span class="ruby-identifier">pr</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">n</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-value">1000</span>
581:         <span class="ruby-ivar">@tbcbmutex</span>.<span class="ruby-identifier">synchronize</span> { <span class="ruby-identifier">pr</span> = <span class="ruby-ivar">@processing</span> }
582:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">pr</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
583:           <span class="ruby-identifier">n</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>
584:           <span class="ruby-constant">Jabber</span><span class="ruby-operator">::</span><span class="ruby-identifier">debuglog</span>(<span class="ruby-node">&quot;TRYING TO CLOSE, STILL PROCESSING #{pr} STANZAS&quot;</span>)
585:           <span class="ruby-comment cmt">#puts(&quot;TRYING TO CLOSE, STILL PROCESSING #{pr} STANZAS&quot;)</span>
586:           <span class="ruby-constant">Thread</span><span class="ruby-operator">::</span><span class="ruby-identifier">pass</span>
587:         <span class="ruby-keyword kw">end</span>
588:       <span class="ruby-keyword kw">end</span>
589: 
590:       <span class="ruby-comment cmt"># Order Matters here! If this method is called from within </span>
591:       <span class="ruby-comment cmt"># @parser_thread then killing @parser_thread first would </span>
592:       <span class="ruby-comment cmt"># mean the other parts of the method fail to execute. </span>
593:       <span class="ruby-comment cmt"># That would be bad. So kill parser_thread last</span>
594:       <span class="ruby-ivar">@fd</span>.<span class="ruby-identifier">close</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@fd</span> <span class="ruby-keyword kw">and</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@fd</span>.<span class="ruby-identifier">closed?</span>
595:       <span class="ruby-ivar">@status</span> = <span class="ruby-constant">DISCONNECTED</span>
596:       <span class="ruby-ivar">@parser_thread</span>.<span class="ruby-identifier">kill</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@parser_thread</span>
597:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000656" class="method-detail">
        <a name="M000656"></a>

        <div class="method-heading">
          <a href="#M000656" class="method-signature">
          <span class="method-name">delete_iq_callback</span><span class="method-args">(ref)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Delete an <a href="Iq.html">Iq</a> callback
</p>
<table>
<tr><td valign="top">ref:</td><td>[String] The reference of the callback to delete

</td></tr>
</table>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000656-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000656-source">
<pre>
     <span class="ruby-comment cmt"># File lib/xmpp4r/stream.rb, line 563</span>
563:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">delete_iq_callback</span>(<span class="ruby-identifier">ref</span>)
564:       <span class="ruby-ivar">@tbcbmutex</span>.<span class="ruby-identifier">synchronize</span> <span class="ruby-keyword kw">do</span>
565:         <span class="ruby-ivar">@iqcbs</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">ref</span>)
566:       <span class="ruby-keyword kw">end</span>
567:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000650" class="method-detail">
        <a name="M000650"></a>

        <div class="method-heading">
          <a href="#M000650" class="method-signature">
          <span class="method-name">delete_message_callback</span><span class="method-args">(ref)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Delete an <a href="Message.html">Message</a> callback
</p>
<table>
<tr><td valign="top">ref:</td><td>[String] The reference of the callback to delete

</td></tr>
</table>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000650-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000650-source">
<pre>
     <span class="ruby-comment cmt"># File lib/xmpp4r/stream.rb, line 496</span>
496:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">delete_message_callback</span>(<span class="ruby-identifier">ref</span>)
497:       <span class="ruby-ivar">@tbcbmutex</span>.<span class="ruby-identifier">synchronize</span> <span class="ruby-keyword kw">do</span>
498:         <span class="ruby-ivar">@messagecbs</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">ref</span>)
499:       <span class="ruby-keyword kw">end</span>
500:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000654" class="method-detail">
        <a name="M000654"></a>

        <div class="method-heading">
          <a href="#M000654" class="method-signature">
          <span class="method-name">delete_presence_callback</span><span class="method-args">(ref)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Delete a <a href="Presence.html">Presence</a> callback
</p>
<table>
<tr><td valign="top">ref:</td><td>[String] The reference of the callback to delete

</td></tr>
</table>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000654-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000654-source">
<pre>
     <span class="ruby-comment cmt"># File lib/xmpp4r/stream.rb, line 540</span>
540:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">delete_presence_callback</span>(<span class="ruby-identifier">ref</span>)
541:       <span class="ruby-ivar">@tbcbmutex</span>.<span class="ruby-identifier">synchronize</span> <span class="ruby-keyword kw">do</span>
542:         <span class="ruby-ivar">@presencecbs</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">ref</span>)
543:       <span class="ruby-keyword kw">end</span>
544:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000652" class="method-detail">
        <a name="M000652"></a>

        <div class="method-heading">
          <a href="#M000652" class="method-signature">
          <span class="method-name">delete_stanza_callback</span><span class="method-args">(ref)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Delete a Stanza callback
</p>
<table>
<tr><td valign="top">ref:</td><td>[String] The reference of the callback to delete

</td></tr>
</table>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000652-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000652-source">
<pre>
     <span class="ruby-comment cmt"># File lib/xmpp4r/stream.rb, line 518</span>
518:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">delete_stanza_callback</span>(<span class="ruby-identifier">ref</span>)
519:       <span class="ruby-ivar">@tbcbmutex</span>.<span class="ruby-identifier">synchronize</span> <span class="ruby-keyword kw">do</span>
520:         <span class="ruby-ivar">@stanzacbs</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">ref</span>)
521:       <span class="ruby-keyword kw">end</span>
522:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000648" class="method-detail">
        <a name="M000648"></a>

        <div class="method-heading">
          <a href="#M000648" class="method-signature">
          <span class="method-name">delete_xml_callback</span><span class="method-args">(ref)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Delete an XML-messages callback
</p>
<table>
<tr><td valign="top">ref:</td><td>[String] The reference of the callback to delete

</td></tr>
</table>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000648-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000648-source">
<pre>
     <span class="ruby-comment cmt"># File lib/xmpp4r/stream.rb, line 474</span>
474:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">delete_xml_callback</span>(<span class="ruby-identifier">ref</span>)
475:       <span class="ruby-ivar">@tbcbmutex</span>.<span class="ruby-identifier">synchronize</span> <span class="ruby-keyword kw">do</span>
476:         <span class="ruby-ivar">@xmlcbs</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">ref</span>)
477:       <span class="ruby-keyword kw">end</span>
478:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000639" class="method-detail">
        <a name="M000639"></a>

        <div class="method-heading">
          <a href="#M000639" class="method-signature">
          <span class="method-name">iq_callbacks</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Get the list of iq callbacks.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000639-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000639-source">
<pre>
     <span class="ruby-comment cmt"># File lib/xmpp4r/stream.rb, line 289</span>
289:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">iq_callbacks</span>
290:       <span class="ruby-ivar">@iqcbs</span>
291:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000636" class="method-detail">
        <a name="M000636"></a>

        <div class="method-heading">
          <a href="#M000636" class="method-signature">
          <span class="method-name">is_connected?</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns if this connection is connected to a <a
href="../Jabber.html">Jabber</a> service
</p>
<table>
<tr><td valign="top">return:</td><td>[Boolean] <a href="Connection.html">Connection</a> status

</td></tr>
</table>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000636-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000636-source">
<pre>
     <span class="ruby-comment cmt"># File lib/xmpp4r/stream.rb, line 160</span>
160:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">is_connected?</span>
161:       <span class="ruby-keyword kw">return</span> <span class="ruby-ivar">@status</span> <span class="ruby-operator">==</span> <span class="ruby-constant">CONNECTED</span>
162:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000637" class="method-detail">
        <a name="M000637"></a>

        <div class="method-heading">
          <a href="#M000637" class="method-signature">
          <span class="method-name">is_disconnected?</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns if this connection is NOT connected to a <a
href="../Jabber.html">Jabber</a> service
</p>
<table>
<tr><td valign="top">return:</td><td>[Boolean] <a href="Connection.html">Connection</a> status

</td></tr>
</table>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000637-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000637-source">
<pre>
     <span class="ruby-comment cmt"># File lib/xmpp4r/stream.rb, line 168</span>
168:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">is_disconnected?</span>
169:       <span class="ruby-keyword kw">return</span> <span class="ruby-ivar">@status</span> <span class="ruby-operator">==</span> <span class="ruby-constant">DISCONNECTED</span>
170:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000640" class="method-detail">
        <a name="M000640"></a>

        <div class="method-heading">
          <a href="#M000640" class="method-signature">
          <span class="method-name">message_callbacks</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Get the list of message callbacks.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000640-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000640-source">
<pre>
     <span class="ruby-comment cmt"># File lib/xmpp4r/stream.rb, line 295</span>
295:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">message_callbacks</span>
296:       <span class="ruby-ivar">@messagecbs</span>
297:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000633" class="method-detail">
        <a name="M000633"></a>

        <div class="method-heading">
          <a href="#M000633" class="method-signature">
          <span class="method-name">on_exception</span><span class="method-args">(&amp;block)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Mounts a block to handle exceptions if they occur during the poll <a
href="Stream.html#M000645">send</a>. This will likely be the first
indication that the socket dropped in a <a href="../Jabber.html">Jabber</a>
Session.
</p>
<p>
The block has to take three arguments:
</p>
<ul>
<li>the Exception

</li>
<li>the <a href="Stream.html">Jabber::Stream</a> object (self)

</li>
<li>a symbol where it happened, namely :<a
href="Stream.html#M000631">start</a>, :parser, :sending and :end

</li>
</ul>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000633-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000633-source">
<pre>
     <span class="ruby-comment cmt"># File lib/xmpp4r/stream.rb, line 117</span>
117:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">on_exception</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
118:       <span class="ruby-ivar">@exception_block</span> = <span class="ruby-identifier">block</span>
119:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000634" class="method-detail">
        <a name="M000634"></a>

        <div class="method-heading">
          <a href="#M000634" class="method-signature">
          <span class="method-name">parse_failure</span><span class="method-args">(e)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
This method is called by the parser when a failure occurs
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000634-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000634-source">
<pre>
     <span class="ruby-comment cmt"># File lib/xmpp4r/stream.rb, line 123</span>
123:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">parse_failure</span>(<span class="ruby-identifier">e</span>)
124:       <span class="ruby-constant">Jabber</span><span class="ruby-operator">::</span><span class="ruby-identifier">warnlog</span>(<span class="ruby-node">&quot;EXCEPTION:\n#{e.class}\n#{e.message}\n#{e.backtrace.join(&quot;\n&quot;)}&quot;</span>)
125: 
126:       <span class="ruby-comment cmt"># A new thread has to be created because close will cause the thread</span>
127:       <span class="ruby-comment cmt"># to commit suicide(???)</span>
128:       <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@exception_block</span>
129:         <span class="ruby-comment cmt"># New thread, because close will kill the current thread</span>
130:         <span class="ruby-constant">Thread</span>.<span class="ruby-identifier">new</span> <span class="ruby-keyword kw">do</span>
131:           <span class="ruby-constant">Thread</span>.<span class="ruby-identifier">current</span>.<span class="ruby-identifier">abort_on_exception</span> = <span class="ruby-keyword kw">true</span>
132:           <span class="ruby-identifier">close</span>
133:           <span class="ruby-ivar">@exception_block</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">e</span>, <span class="ruby-keyword kw">self</span>, <span class="ruby-identifier">:parser</span>)
134:         <span class="ruby-keyword kw">end</span>
135:       <span class="ruby-keyword kw">else</span>
136:         <span class="ruby-constant">Jabber</span><span class="ruby-operator">::</span><span class="ruby-identifier">warnlog</span> <span class="ruby-value str">&quot;Stream#parse_failure was called by XML parser. Dumping &quot;</span> <span class="ruby-operator">+</span>
137:           <span class="ruby-value str">&quot;backtrace...\n&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">e</span>.<span class="ruby-identifier">exception</span> <span class="ruby-operator">+</span> <span class="ruby-node">&quot;\n#{e.backtrace.join(&quot;\n&quot;)}&quot;</span>
138:         <span class="ruby-identifier">close</span>
139:         <span class="ruby-identifier">raise</span>
140:       <span class="ruby-keyword kw">end</span>
141:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000635" class="method-detail">
        <a name="M000635"></a>

        <div class="method-heading">
          <a href="#M000635" class="method-signature">
          <span class="method-name">parser_end</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
This method is called by the parser upon receiving
<tt>&lt;/stream:stream&gt;</tt>
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000635-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000635-source">
<pre>
     <span class="ruby-comment cmt"># File lib/xmpp4r/stream.rb, line 145</span>
145:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">parser_end</span>
146:       <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@exception_block</span>
147:         <span class="ruby-constant">Thread</span>.<span class="ruby-identifier">new</span> <span class="ruby-keyword kw">do</span>
148:           <span class="ruby-constant">Thread</span>.<span class="ruby-identifier">current</span>.<span class="ruby-identifier">abort_on_exception</span> = <span class="ruby-keyword kw">true</span>
149:           <span class="ruby-identifier">close</span>
150:           <span class="ruby-ivar">@exception_block</span>.<span class="ruby-identifier">call</span>(<span class="ruby-keyword kw">nil</span>, <span class="ruby-keyword kw">self</span>, <span class="ruby-identifier">:close</span>)
151:         <span class="ruby-keyword kw">end</span>
152:       <span class="ruby-keyword kw">else</span>
153:         <span class="ruby-identifier">close</span>
154:       <span class="ruby-keyword kw">end</span>
155:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000641" class="method-detail">
        <a name="M000641"></a>

        <div class="method-heading">
          <a href="#M000641" class="method-signature">
          <span class="method-name">presence_callbacks</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Get the list of presence callbacks.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000641-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000641-source">
<pre>
     <span class="ruby-comment cmt"># File lib/xmpp4r/stream.rb, line 301</span>
301:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">presence_callbacks</span>
302:       <span class="ruby-ivar">@presencecbs</span>
303:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000638" class="method-detail">
        <a name="M000638"></a>

        <div class="method-heading">
          <a href="#M000638" class="method-signature">
          <span class="method-name">receive</span><span class="method-args">(element)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Processes a received <a href="../REXML/Element.html">REXML::Element</a> and
executes registered thread blocks and filters against it.
</p>
<table>
<tr><td valign="top">element:</td><td>[<a href="../REXML/Element.html">REXML::Element</a>] The received element

</td></tr>
</table>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000638-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000638-source">
<pre>
     <span class="ruby-comment cmt"># File lib/xmpp4r/stream.rb, line 177</span>
177:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">receive</span>(<span class="ruby-identifier">element</span>)
178:       <span class="ruby-ivar">@tbcbmutex</span>.<span class="ruby-identifier">synchronize</span> { <span class="ruby-ivar">@processing</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span> }
179:       <span class="ruby-constant">Jabber</span><span class="ruby-operator">::</span><span class="ruby-identifier">debuglog</span>(<span class="ruby-node">&quot;RECEIVED:\n#{element.to_s}&quot;</span>)
180: 
181:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">element</span>.<span class="ruby-identifier">namespace</span>(<span class="ruby-value str">''</span>).<span class="ruby-identifier">to_s</span> <span class="ruby-operator">==</span> <span class="ruby-value str">''</span> <span class="ruby-comment cmt"># REXML namespaces are always strings</span>
182:         <span class="ruby-identifier">element</span>.<span class="ruby-identifier">add_namespace</span>(<span class="ruby-ivar">@streamns</span>)
183:       <span class="ruby-keyword kw">end</span>
184: 
185:       <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">element</span>.<span class="ruby-identifier">prefix</span>
186:       <span class="ruby-keyword kw">when</span> <span class="ruby-value str">'stream'</span>
187:         <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">element</span>.<span class="ruby-identifier">name</span>
188:           <span class="ruby-keyword kw">when</span> <span class="ruby-value str">'stream'</span>
189:             <span class="ruby-identifier">stanza</span> = <span class="ruby-identifier">element</span>
190:             <span class="ruby-ivar">@streamid</span> = <span class="ruby-identifier">element</span>.<span class="ruby-identifier">attributes</span>[<span class="ruby-value str">'id'</span>]
191:             <span class="ruby-ivar">@streamns</span> = <span class="ruby-identifier">element</span>.<span class="ruby-identifier">namespace</span>(<span class="ruby-value str">''</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">element</span>.<span class="ruby-identifier">namespace</span>(<span class="ruby-value str">''</span>)
192: 
193:             <span class="ruby-comment cmt"># Hack: component streams are basically client streams.</span>
194:             <span class="ruby-comment cmt"># Someday we may want to create special stanza classes</span>
195:             <span class="ruby-comment cmt"># for components/s2s deriving from normal stanzas but</span>
196:             <span class="ruby-comment cmt"># posessing these namespaces</span>
197:             <span class="ruby-ivar">@streamns</span> = <span class="ruby-value str">'jabber:client'</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@streamns</span> <span class="ruby-operator">==</span> <span class="ruby-value str">'jabber:component:accept'</span>
198: 
199:             <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">element</span>.<span class="ruby-identifier">attributes</span>[<span class="ruby-value str">'version'</span>]  <span class="ruby-comment cmt"># isn't XMPP compliant, so</span>
200:               <span class="ruby-constant">Jabber</span><span class="ruby-operator">::</span><span class="ruby-identifier">debuglog</span>(<span class="ruby-value str">&quot;FEATURES: server not XMPP compliant, will not wait for features&quot;</span>)
201:               <span class="ruby-ivar">@features_sem</span>.<span class="ruby-identifier">run</span>                   <span class="ruby-comment cmt"># don't wait for &lt;stream:features/&gt;</span>
202:             <span class="ruby-keyword kw">end</span>
203:           <span class="ruby-keyword kw">when</span> <span class="ruby-value str">'features'</span>
204:             <span class="ruby-identifier">stanza</span> = <span class="ruby-identifier">element</span>
205:             <span class="ruby-identifier">element</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">e</span><span class="ruby-operator">|</span>
206:               <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">e</span>.<span class="ruby-identifier">name</span> <span class="ruby-operator">==</span> <span class="ruby-value str">'mechanisms'</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">e</span>.<span class="ruby-identifier">namespace</span> <span class="ruby-operator">==</span> <span class="ruby-value str">'urn:ietf:params:xml:ns:xmpp-sasl'</span>
207:                 <span class="ruby-identifier">e</span>.<span class="ruby-identifier">each_element</span>(<span class="ruby-value str">'mechanism'</span>) { <span class="ruby-operator">|</span><span class="ruby-identifier">mech</span><span class="ruby-operator">|</span>
208:                   <span class="ruby-ivar">@stream_mechanisms</span>.<span class="ruby-identifier">push</span>(<span class="ruby-identifier">mech</span>.<span class="ruby-identifier">text</span>)
209:                 }
210:               <span class="ruby-keyword kw">else</span>
211:                 <span class="ruby-ivar">@stream_features</span>[<span class="ruby-identifier">e</span>.<span class="ruby-identifier">name</span>] = <span class="ruby-identifier">e</span>.<span class="ruby-identifier">namespace</span>
212:               <span class="ruby-keyword kw">end</span>
213:             }
214:             <span class="ruby-constant">Jabber</span><span class="ruby-operator">::</span><span class="ruby-identifier">debuglog</span>(<span class="ruby-value str">&quot;FEATURES: received&quot;</span>)
215:             <span class="ruby-ivar">@features_sem</span>.<span class="ruby-identifier">run</span>
216:           <span class="ruby-keyword kw">else</span>
217:             <span class="ruby-identifier">stanza</span> = <span class="ruby-identifier">element</span>
218:         <span class="ruby-keyword kw">end</span>
219:       <span class="ruby-keyword kw">else</span>
220:         <span class="ruby-comment cmt"># Any stanza, classes are registered by XMPPElement::name_xmlns</span>
221:         <span class="ruby-keyword kw">begin</span>
222:           <span class="ruby-identifier">stanza</span> = <span class="ruby-constant">XMPPStanza</span><span class="ruby-operator">::</span><span class="ruby-identifier">import</span>(<span class="ruby-identifier">element</span>)
223:         <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">NoNameXmlnsRegistered</span>
224:           <span class="ruby-identifier">stanza</span> = <span class="ruby-identifier">element</span>
225:         <span class="ruby-keyword kw">end</span>
226:       <span class="ruby-keyword kw">end</span>
227: 
228:       <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@xmlcbs</span>.<span class="ruby-identifier">process</span>(<span class="ruby-identifier">stanza</span>)
229:         <span class="ruby-ivar">@tbcbmutex</span>.<span class="ruby-identifier">synchronize</span> { <span class="ruby-ivar">@processing</span> <span class="ruby-operator">-=</span> <span class="ruby-value">1</span> }
230:         <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">true</span>
231:       <span class="ruby-keyword kw">end</span>
232: 
233:       <span class="ruby-comment cmt"># Iterate through blocked threads (= waiting for an answer)</span>
234:       <span class="ruby-comment cmt">#</span>
235:       <span class="ruby-comment cmt"># We're dup'ping the @threadblocks here, so that we won't end up in an</span>
236:       <span class="ruby-comment cmt"># endless loop if Stream#send is being nested. That means, the nested</span>
237:       <span class="ruby-comment cmt"># threadblock won't receive the stanza currently processed, but the next</span>
238:       <span class="ruby-comment cmt"># one.</span>
239:       <span class="ruby-identifier">threadblocks</span> = <span class="ruby-keyword kw">nil</span>
240:       <span class="ruby-ivar">@tbcbmutex</span>.<span class="ruby-identifier">synchronize</span> <span class="ruby-keyword kw">do</span>
241:         <span class="ruby-identifier">threadblocks</span> = <span class="ruby-ivar">@threadblocks</span>.<span class="ruby-identifier">dup</span>
242:       <span class="ruby-keyword kw">end</span>
243:       <span class="ruby-identifier">threadblocks</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">threadblock</span><span class="ruby-operator">|</span>
244:         <span class="ruby-identifier">exception</span> = <span class="ruby-keyword kw">nil</span>
245:         <span class="ruby-identifier">r</span> = <span class="ruby-keyword kw">false</span>
246:         <span class="ruby-keyword kw">begin</span>
247:           <span class="ruby-identifier">r</span> = <span class="ruby-identifier">threadblock</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">stanza</span>)
248:         <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">Exception</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">e</span>
249:           <span class="ruby-identifier">exception</span> = <span class="ruby-identifier">e</span>
250:         <span class="ruby-keyword kw">end</span>
251: 
252:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">r</span> <span class="ruby-operator">==</span> <span class="ruby-keyword kw">true</span>
253:           <span class="ruby-ivar">@tbcbmutex</span>.<span class="ruby-identifier">synchronize</span> <span class="ruby-keyword kw">do</span>
254:             <span class="ruby-ivar">@threadblocks</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">threadblock</span>)
255:           <span class="ruby-keyword kw">end</span>
256:           <span class="ruby-identifier">threadblock</span>.<span class="ruby-identifier">wakeup</span>
257:           <span class="ruby-ivar">@tbcbmutex</span>.<span class="ruby-identifier">synchronize</span> { <span class="ruby-ivar">@processing</span> <span class="ruby-operator">-=</span> <span class="ruby-value">1</span> }
258:           <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">true</span>
259:         <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">exception</span>
260:           <span class="ruby-ivar">@tbcbmutex</span>.<span class="ruby-identifier">synchronize</span> <span class="ruby-keyword kw">do</span>
261:             <span class="ruby-ivar">@threadblocks</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">threadblock</span>)
262:           <span class="ruby-keyword kw">end</span>
263:           <span class="ruby-identifier">threadblock</span>.<span class="ruby-identifier">raise</span>(<span class="ruby-identifier">exception</span>)
264:         <span class="ruby-keyword kw">end</span>
265:       }
266: 
267:       <span class="ruby-constant">Jabber</span><span class="ruby-operator">::</span><span class="ruby-identifier">debuglog</span>(<span class="ruby-node">&quot;PROCESSING:\n#{stanza.to_s} (#{stanza.class})&quot;</span>)
268:       <span class="ruby-constant">Jabber</span><span class="ruby-operator">::</span><span class="ruby-identifier">debuglog</span>(<span class="ruby-value str">&quot;TRYING stanzacbs...&quot;</span>)
269:       <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@stanzacbs</span>.<span class="ruby-identifier">process</span>(<span class="ruby-identifier">stanza</span>)
270:           <span class="ruby-ivar">@tbcbmutex</span>.<span class="ruby-identifier">synchronize</span> { <span class="ruby-ivar">@processing</span> <span class="ruby-operator">-=</span> <span class="ruby-value">1</span> }
271:           <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">true</span>
272:       <span class="ruby-keyword kw">end</span>
273:       <span class="ruby-identifier">r</span> = <span class="ruby-keyword kw">false</span>
274:       <span class="ruby-constant">Jabber</span><span class="ruby-operator">::</span><span class="ruby-identifier">debuglog</span>(<span class="ruby-value str">&quot;TRYING message/iq/presence/cbs...&quot;</span>)
275:       <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">stanza</span>
276:       <span class="ruby-keyword kw">when</span> <span class="ruby-constant">Message</span>
277:         <span class="ruby-identifier">r</span> = <span class="ruby-ivar">@messagecbs</span>.<span class="ruby-identifier">process</span>(<span class="ruby-identifier">stanza</span>)
278:       <span class="ruby-keyword kw">when</span> <span class="ruby-constant">Iq</span>
279:         <span class="ruby-identifier">r</span> = <span class="ruby-ivar">@iqcbs</span>.<span class="ruby-identifier">process</span>(<span class="ruby-identifier">stanza</span>)
280:       <span class="ruby-keyword kw">when</span> <span class="ruby-constant">Presence</span>
281:         <span class="ruby-identifier">r</span> = <span class="ruby-ivar">@presencecbs</span>.<span class="ruby-identifier">process</span>(<span class="ruby-identifier">stanza</span>)
282:       <span class="ruby-keyword kw">end</span>
283:       <span class="ruby-ivar">@tbcbmutex</span>.<span class="ruby-identifier">synchronize</span> { <span class="ruby-ivar">@processing</span> <span class="ruby-operator">-=</span> <span class="ruby-value">1</span> }
284:       <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">r</span>
285:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000645" class="method-detail">
        <a name="M000645"></a>

        <div class="method-heading">
          <a href="#M000645" class="method-signature">
          <span class="method-name">send</span><span class="method-args">(xml, &amp;block)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Sends XML data to the socket and (optionally) waits to process received
data.
</p>
<p>
Do not invoke this in a callback but in a seperate thread because we may
not suspend the parser-thread (in whose context callbacks are executed).
</p>
<table>
<tr><td valign="top">xml:</td><td>[String] The xml data to <a href="Stream.html#M000645">send</a>

</td></tr>
<tr><td valign="top">&amp;block:</td><td>[Block] The optional block

</td></tr>
</table>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000645-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000645-source">
<pre>
     <span class="ruby-comment cmt"># File lib/xmpp4r/stream.rb, line 361</span>
361:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">send</span>(<span class="ruby-identifier">xml</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
362:       <span class="ruby-constant">Jabber</span><span class="ruby-operator">::</span><span class="ruby-identifier">debuglog</span>(<span class="ruby-node">&quot;SENDING:\n#{xml}&quot;</span>)
363:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">block</span>
364:         <span class="ruby-identifier">threadblock</span> = <span class="ruby-constant">ThreadBlock</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">block</span>)
365:         <span class="ruby-ivar">@tbcbmutex</span>.<span class="ruby-identifier">synchronize</span> <span class="ruby-keyword kw">do</span>
366:           <span class="ruby-ivar">@threadblocks</span>.<span class="ruby-identifier">unshift</span>(<span class="ruby-identifier">threadblock</span>)
367:         <span class="ruby-keyword kw">end</span>
368:       <span class="ruby-keyword kw">end</span>
369:       <span class="ruby-keyword kw">begin</span>
370:         <span class="ruby-comment cmt"># Temporarily remove stanza's namespace to</span>
371:         <span class="ruby-comment cmt"># reduce bandwidth consumption</span>
372:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">xml</span>.<span class="ruby-identifier">kind_of?</span> <span class="ruby-constant">XMPPStanza</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">xml</span>.<span class="ruby-identifier">namespace</span> <span class="ruby-operator">==</span> <span class="ruby-value str">'jabber:client'</span> <span class="ruby-keyword kw">and</span>
373:             <span class="ruby-identifier">xml</span>.<span class="ruby-identifier">prefix</span> <span class="ruby-operator">!=</span> <span class="ruby-value str">'stream'</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">xml</span>.<span class="ruby-identifier">name</span> <span class="ruby-operator">!=</span> <span class="ruby-value str">'stream'</span>
374:           <span class="ruby-identifier">xml</span>.<span class="ruby-identifier">delete_namespace</span>
375:           <span class="ruby-identifier">send_data</span>(<span class="ruby-identifier">xml</span>.<span class="ruby-identifier">to_s</span>)
376:           <span class="ruby-identifier">xml</span>.<span class="ruby-identifier">add_namespace</span>(<span class="ruby-ivar">@streamns</span>)
377:         <span class="ruby-keyword kw">else</span>
378:           <span class="ruby-identifier">send_data</span>(<span class="ruby-identifier">xml</span>.<span class="ruby-identifier">to_s</span>)
379:         <span class="ruby-keyword kw">end</span>
380:       <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">Exception</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">e</span>
381:         <span class="ruby-constant">Jabber</span><span class="ruby-operator">::</span><span class="ruby-identifier">warnlog</span>(<span class="ruby-node">&quot;EXCEPTION:\n#{e.class}\n#{e.message}\n#{e.backtrace.join(&quot;\n&quot;)}&quot;</span>)
382: 
383:         <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@exception_block</span>
384:           <span class="ruby-constant">Thread</span>.<span class="ruby-identifier">new</span> <span class="ruby-keyword kw">do</span>
385:             <span class="ruby-constant">Thread</span>.<span class="ruby-identifier">current</span>.<span class="ruby-identifier">abort_on_exception</span> = <span class="ruby-keyword kw">true</span>
386:             <span class="ruby-identifier">close!</span>
387:             <span class="ruby-ivar">@exception_block</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">e</span>, <span class="ruby-keyword kw">self</span>, <span class="ruby-identifier">:sending</span>)
388:           <span class="ruby-keyword kw">end</span>
389:         <span class="ruby-keyword kw">else</span>
390:           <span class="ruby-constant">Jabber</span><span class="ruby-operator">::</span><span class="ruby-identifier">warnlog</span> <span class="ruby-node">&quot;Exception caught while sending! (#{e.class})\n#{e.backtrace.join(&quot;\n&quot;)}&quot;</span>
391:           <span class="ruby-identifier">close!</span>
392:           <span class="ruby-identifier">raise</span>
393:         <span class="ruby-keyword kw">end</span>
394:       <span class="ruby-keyword kw">end</span>
395:       <span class="ruby-comment cmt"># The parser thread might be running this (think of a callback running send())</span>
396:       <span class="ruby-comment cmt"># If this is the case, we mustn't stop (or we would cause a deadlock)</span>
397:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">block</span> <span class="ruby-keyword kw">and</span> <span class="ruby-constant">Thread</span>.<span class="ruby-identifier">current</span> <span class="ruby-operator">!=</span> <span class="ruby-ivar">@parser_thread</span>
398:         <span class="ruby-identifier">threadblock</span>.<span class="ruby-identifier">wait</span>
399:       <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">block</span>
400:         <span class="ruby-constant">Jabber</span><span class="ruby-operator">::</span><span class="ruby-identifier">warnlog</span>(<span class="ruby-value str">&quot;WARNING:\nCannot stop current thread in Jabber::Stream#send because it is the parser thread!&quot;</span>)
401:       <span class="ruby-keyword kw">end</span>
402:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000644" class="method-detail">
        <a name="M000644"></a>

        <div class="method-heading">
          <a href="#M000644" class="method-signature">
          <span class="method-name">send_data</span><span class="method-args">(data)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000644-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000644-source">
<pre>
     <span class="ruby-comment cmt"># File lib/xmpp4r/stream.rb, line 343</span>
343:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">send_data</span>(<span class="ruby-identifier">data</span>)
344:       <span class="ruby-ivar">@send_lock</span>.<span class="ruby-identifier">synchronize</span> <span class="ruby-keyword kw">do</span>
345:         <span class="ruby-ivar">@last_send</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
346:         <span class="ruby-ivar">@fd</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">data</span>
347:         <span class="ruby-ivar">@fd</span>.<span class="ruby-identifier">flush</span>
348:       <span class="ruby-keyword kw">end</span>
349:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000646" class="method-detail">
        <a name="M000646"></a>

        <div class="method-heading">
          <a href="#M000646" class="method-signature">
          <span class="method-name">send_with_id</span><span class="method-args">(xml) {|received| ...}</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Send an XMMP stanza with an <a
href="XMPPStanza.html#M000760">Jabber::XMPPStanza#id</a>. The id will be
generated by <a href="IdGenerator.html">Jabber::IdGenerator</a> if not
already set.
</p>
<p>
The block will be called once: when receiving a stanza with the same <a
href="XMPPStanza.html#M000760">Jabber::XMPPStanza#id</a>. There is no need
to return true to complete this! Instead the return value of the block will
be returned. This is a direct result of unique request/response stanza
identification via the id attribute.
</p>
<p>
The block may be omitted. Then, the result will be the response stanza.
</p>
<p>
Be aware that if a stanza with <tt>type=&#8216;error&#8216;</tt> is
received the function does not yield but raises an ServerError with the
corresponding error element.
</p>
<p>
Please see <a href="Stream.html#M000645">Stream#send</a> for some
implementational details.
</p>
<p>
Please read the note about nesting at <a
href="Stream.html#M000645">Stream#send</a>
</p>
<table>
<tr><td valign="top">xml:</td><td>[<a href="XMPPStanza.html">XMPPStanza</a>]

</td></tr>
</table>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000646-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000646-source">
<pre>
     <span class="ruby-comment cmt"># File lib/xmpp4r/stream.rb, line 425</span>
425:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">send_with_id</span>(<span class="ruby-identifier">xml</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
426:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">xml</span>.<span class="ruby-identifier">id</span>.<span class="ruby-identifier">nil?</span>
427:         <span class="ruby-identifier">xml</span>.<span class="ruby-identifier">id</span> = <span class="ruby-constant">Jabber</span><span class="ruby-operator">::</span><span class="ruby-constant">IdGenerator</span>.<span class="ruby-identifier">instance</span>.<span class="ruby-identifier">generate_id</span>
428:       <span class="ruby-keyword kw">end</span>
429: 
430:       <span class="ruby-identifier">res</span> = <span class="ruby-keyword kw">nil</span>
431:       <span class="ruby-identifier">error</span> = <span class="ruby-keyword kw">nil</span>
432:       <span class="ruby-identifier">send</span>(<span class="ruby-identifier">xml</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">received</span><span class="ruby-operator">|</span>
433:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">received</span>.<span class="ruby-identifier">kind_of?</span> <span class="ruby-constant">XMPPStanza</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">received</span>.<span class="ruby-identifier">id</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">xml</span>.<span class="ruby-identifier">id</span>
434:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">received</span>.<span class="ruby-identifier">type</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">:error</span>
435:             <span class="ruby-identifier">error</span> = (<span class="ruby-identifier">received</span>.<span class="ruby-identifier">error</span> <span class="ruby-value">? </span><span class="ruby-identifier">received</span>.<span class="ruby-identifier">error</span> <span class="ruby-operator">:</span> <span class="ruby-constant">ErrorResponse</span>.<span class="ruby-identifier">new</span>)
436:             <span class="ruby-keyword kw">true</span>
437:           <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">block_given?</span>
438:             <span class="ruby-identifier">res</span> = <span class="ruby-keyword kw">yield</span>(<span class="ruby-identifier">received</span>)
439:             <span class="ruby-keyword kw">true</span>
440:           <span class="ruby-keyword kw">else</span>
441:             <span class="ruby-identifier">res</span> = <span class="ruby-identifier">received</span>
442:             <span class="ruby-keyword kw">true</span>
443:           <span class="ruby-keyword kw">end</span>
444:         <span class="ruby-keyword kw">else</span>
445:           <span class="ruby-keyword kw">false</span>
446:         <span class="ruby-keyword kw">end</span>
447:       <span class="ruby-keyword kw">end</span>
448: 
449:       <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">error</span>.<span class="ruby-identifier">nil?</span>
450:         <span class="ruby-identifier">raise</span> <span class="ruby-constant">ServerError</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">error</span>)
451:       <span class="ruby-keyword kw">end</span>
452: 
453:       <span class="ruby-identifier">res</span>
454:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000642" class="method-detail">
        <a name="M000642"></a>

        <div class="method-heading">
          <a href="#M000642" class="method-signature">
          <span class="method-name">stanza_callbacks</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Get the list of stanza callbacks.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000642-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000642-source">
<pre>
     <span class="ruby-comment cmt"># File lib/xmpp4r/stream.rb, line 307</span>
307:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">stanza_callbacks</span>
308:       <span class="ruby-ivar">@stanzacbs</span>
309:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000631" class="method-detail">
        <a name="M000631"></a>

        <div class="method-heading">
          <a href="#M000631" class="method-signature">
          <span class="method-name">start</span><span class="method-args">(fd)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Start the XML parser on the fd
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000631-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000631-source">
<pre>
     <span class="ruby-comment cmt"># File lib/xmpp4r/stream.rb, line 66</span>
 66:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">start</span>(<span class="ruby-identifier">fd</span>)
 67:       <span class="ruby-ivar">@stream_mechanisms</span> = []
 68:       <span class="ruby-ivar">@stream_features</span> = {}
 69: 
 70:       <span class="ruby-ivar">@fd</span> = <span class="ruby-identifier">fd</span>
 71:       <span class="ruby-ivar">@parser</span> = <span class="ruby-constant">StreamParser</span>.<span class="ruby-identifier">new</span>(<span class="ruby-ivar">@fd</span>, <span class="ruby-keyword kw">self</span>)
 72:       <span class="ruby-ivar">@parser_thread</span> = <span class="ruby-constant">Thread</span>.<span class="ruby-identifier">new</span> <span class="ruby-keyword kw">do</span>
 73:         <span class="ruby-constant">Thread</span>.<span class="ruby-identifier">current</span>.<span class="ruby-identifier">abort_on_exception</span> = <span class="ruby-keyword kw">true</span>
 74:         <span class="ruby-keyword kw">begin</span>
 75:           <span class="ruby-ivar">@parser</span>.<span class="ruby-identifier">parse</span>
 76:           <span class="ruby-constant">Jabber</span><span class="ruby-operator">::</span><span class="ruby-identifier">debuglog</span>(<span class="ruby-value str">&quot;DISCONNECTED\n&quot;</span>)
 77: 
 78:           <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@exception_block</span>
 79:             <span class="ruby-constant">Thread</span>.<span class="ruby-identifier">new</span> { <span class="ruby-identifier">close!</span>; <span class="ruby-ivar">@exception_block</span>.<span class="ruby-identifier">call</span>(<span class="ruby-keyword kw">nil</span>, <span class="ruby-keyword kw">self</span>, <span class="ruby-identifier">:disconnected</span>) }
 80:           <span class="ruby-keyword kw">else</span>
 81:             <span class="ruby-identifier">close!</span>
 82:           <span class="ruby-keyword kw">end</span>
 83:         <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">Exception</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">e</span>
 84:           <span class="ruby-constant">Jabber</span><span class="ruby-operator">::</span><span class="ruby-identifier">warnlog</span>(<span class="ruby-node">&quot;EXCEPTION:\n#{e.class}\n#{e.message}\n#{e.backtrace.join(&quot;\n&quot;)}&quot;</span>)
 85: 
 86:           <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@exception_block</span>
 87:             <span class="ruby-constant">Thread</span>.<span class="ruby-identifier">new</span> <span class="ruby-keyword kw">do</span>
 88:               <span class="ruby-constant">Thread</span>.<span class="ruby-identifier">current</span>.<span class="ruby-identifier">abort_on_exception</span> = <span class="ruby-keyword kw">true</span>
 89:               <span class="ruby-identifier">close</span>
 90:               <span class="ruby-ivar">@exception_block</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">e</span>, <span class="ruby-keyword kw">self</span>, <span class="ruby-identifier">:start</span>)
 91:             <span class="ruby-keyword kw">end</span>
 92:           <span class="ruby-keyword kw">else</span>
 93:             <span class="ruby-constant">Jabber</span><span class="ruby-operator">::</span><span class="ruby-identifier">warnlog</span> <span class="ruby-node">&quot;Exception caught in Parser thread! (#{e.class})\n#{e.backtrace.join(&quot;\n&quot;)}&quot;</span>
 94:             <span class="ruby-identifier">close!</span>
 95:             <span class="ruby-identifier">raise</span>
 96:           <span class="ruby-keyword kw">end</span>
 97:         <span class="ruby-keyword kw">end</span>
 98:       <span class="ruby-keyword kw">end</span>
 99: 
100:       <span class="ruby-ivar">@status</span> = <span class="ruby-constant">CONNECTED</span>
101:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000632" class="method-detail">
        <a name="M000632"></a>

        <div class="method-heading">
          <a href="#M000632" class="method-signature">
          <span class="method-name">stop</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000632-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000632-source">
<pre>
     <span class="ruby-comment cmt"># File lib/xmpp4r/stream.rb, line 103</span>
103:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">stop</span>
104:       <span class="ruby-ivar">@parser_thread</span>.<span class="ruby-identifier">kill</span>
105:       <span class="ruby-ivar">@parser</span> = <span class="ruby-keyword kw">nil</span>
106:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000643" class="method-detail">
        <a name="M000643"></a>

        <div class="method-heading">
          <a href="#M000643" class="method-signature">
          <span class="method-name">xml_callbacks</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Get the list of xml callbacks.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000643-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000643-source">
<pre>
     <span class="ruby-comment cmt"># File lib/xmpp4r/stream.rb, line 313</span>
313:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">xml_callbacks</span>
314:       <span class="ruby-ivar">@xmlcbs</span>
315:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>


    </div>


  </div>


<div id="validator-badges">
  <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
</div>

</body>
</html>